<!DOCTYPE html5>
<html>

<head>
  <meta charset="utf-8" />
  <title>Flatstat | Library</title>
  <link rel="stylesheet" type="text/css" href="../index.css">
  </link>
  <link rel="stylesheet" type="text/css" href="./index.css">
  </link>
</head>

<body>
  <header>
    <a href="/flatstat/">
      <h1 id="title" title="Flatstat | Library">flatstat</h1>
    </a>
    <nav>
      <a href="/flatstat/" title="Apps">apps</a>
      <a href="/flatstat/graphs/" title="Graphs">graphs</a>
      <a href="/flatstat/library/" title="Library" class="active">library</a>
      <a href="/flatstat/about/" title="About">about</a>
    </nav>
  </header>
  <main>
    <nav>
      <a id="#achievements" title="Flatpak achievements" href="/flatstat/library/#achievements">ğŸ… achievements</a>
      <a id="#holes" title="Flatpak holes" href="/flatstat/library/#holes">ğŸ’¥ holes</a>
    </nav>
    <section>
      <section id="achievements">
        <!--article> List generated by javascript </article-->
      </section>
      <section id="holes">
        <!--article> List generated by javascript </article-->
      </section>
    </section>
  </main>
</body>
<script type="module">
  import { useJSON } from "../lib/useJSON.js";
  import { useActiveLink } from "../lib/useActiveLink.js";
  import { HOLE_DESCRIPTIONS } from "../lib/holes.js";
  import { ACHIEVEMENT_DESCRIPTIONS } from "../lib/achievements.js";

  useActiveLink("#achievements")
  
  render()
  async function render() {
    const count = await useJSON("../data/flathub/count.json")
    const { achievements: achievementCounts, holes: holeCounts } = count[count.length - 1]; 

    document.querySelector("#achievements").innerHTML = ACHIEVEMENT_DESCRIPTIONS
    .sort((a,b) => (achievementCounts[b.id] ?? 0) - (achievementCounts[a.id] ?? 0))
    .map(achievement => {
      const count = achievementCounts[achievement.id] ?? 0

      return `\
          <article title="ğŸ… ${achievement.id}, earned by ğŸ•¹ï¸ ${count} apps">
            <h3><span>ğŸ… Achievement: ${achievement.id} </span><span>ğŸ•¹ï¸ ${count}</span></h3>
            <p>${achievement.description}</p>
          </article>`
    }).join("\n")

    document.querySelector("#holes").innerHTML = HOLE_DESCRIPTIONS
    .sort((a,b) => (holeCounts[b.id] ?? 0) - (holeCounts[a.id] ?? 0))
    .map(hole => {
      const count = holeCounts[hole.id] ?? 0;

      return `\
          <article title="ğŸ’¥ ${hole.id}, punched by ğŸ•¹ï¸ ${count} apps">
            <h3><span>ğŸ’¥ Hole: ${hole.id}</span><span>ğŸ•¹ï¸ ${count}</span></h3>
            <p>${hole.description}</p>
          </article>
  `;
    }).join("\n")
  }
  
</script>

</html>
