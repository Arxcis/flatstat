<!DOCTYPE html5>
<html>
  <head>
    <meta charset="utf-8" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
    <title>Flatstat | Stats from Flathub.org</title>
    <link rel="stylesheet" type="text/css" href="./index.css"></link>
  </head>
  <body>
    <header>
      <a href="/flatstat/"><h1 id="title" title="Flatstat | Stats from Flathub.org">flatstat</h1></a>
      <nav>
        <a href="/flatstat/#" title="Graphs">graph</a>
        <a href="/flatstat/search/" title="Search">search</a>
      </nav>
    </header>
    <main>
      <a href="/flatstat/#display" title="Display server"><h3 id="display">display server</h3></a>
      <canvas id="display-server-chart" width="400" height="300"></canvas>

      <a href="/flatstat/#filesystem" title="Filesystem"><h3 id="filesystem">filesystem</h3></a>
      <canvas id="filesystem-chart" width="400" height="300"></canvas>

      <a href="/flatstat/#device"title="Device"><h3 id="device">device</h3></a>
      <canvas id="device-chart" width="400" height="300"></canvas>

      <a href="/flatstat/#audio"title="Audio server"><h3 id="device">audio server</h3></a>
      <canvas id="audio-server-chart" width="400" height="300"></canvas>

      <a href="/flatstat/#metadata"title="Metadata filetype"><h3 id="metadata">metadata filetype</h3></a>
      <canvas id="metadata-filetype-chart" width="400" height="300"></canvas>

      <a href="/flatstat/#about" title="About the graphs"><h3 id="about">about</h3></a>
      <p>
        The data is sourced from repos belonging to <a target="_blank" href="https://github.com/flathub/">https://github.com/flathub</a>
      </p>
      <p>
        In each repo, we look for the APP_ID.json file.
      </p>
      <p>
        To get historic data, we use Github Graphql API
        <a target="_blank" href="https://api.github.com/graphql"
          >https://api.github.com/graphql</a
        >.
      </p>
      <p>
        Source code can be found here
        <a target="_blank" href="https://github.com/Arxcis/flatstat"
          >https://github.com/Arxcis/flatstat</a
        >/
      </p>
      <p>
        Thanks to
        <a target="_blank" href="https://www.chartjs.org/">https://www.chartjs.org/</a> for
        drawing the charts!
      </p>
    </main>
  </body>
  <script type="module">
    import count from "./db/flathub/count.js";
   
    let a = document.querySelector(`header a[href*='/#']`)
    a?.classList.add("current")

    const TOTAL_COLOR = "#546e7a";
    const GOOD_COLOR = "#00c853";
    const BAD_COLOR = "#ff9100";
    const VERY_BAD_COLOR = "#ac0800";
    const SUPER_BAD_COLOR = "#4a148c";

    const options = {
      responsive: true,
      tooltips: {
        mode: "index",
        intersect: false,
      },
      hover: {
        mode: "nearest",
        intersect: true,
      },
      scales: {
        xAxes: [
          {
            display: true,
            scaleLabel: {
              display: true,
              labelString: "month",
            },
          },
        ],
        yAxes: [
          {
            display: true,
            scaleLabel: {
              display: true,
              labelString: "apps",
            },
          },
        ],
      },
    };

    new Chart(document.getElementById("display-server-chart").getContext("2d"), {
      type: "line",
      data: {
        labels: count.map((it) => it.key),
        datasets: [
          {
            label: "total",
            backgroundColor: TOTAL_COLOR,
            borderColor: TOTAL_COLOR,
            data: count.map((it) => it.gui),
            fill: false,
            hidden: true,
          },
          {
            label: "--wayland and --fallback-x11",
            backgroundColor: GOOD_COLOR,
            borderColor: GOOD_COLOR,
            data: count.map((it) => it["wayland-and-fallback-x11"]),
            fill: false,
          },
          {
            label: "--wayland and --x11",
            backgroundColor: BAD_COLOR,
            borderColor: BAD_COLOR,
            data: count.map((it) => it["wayland-and-x11"]),
            fill: false,
          },
          {
            label: "--x11 only",
            backgroundColor: VERY_BAD_COLOR,
            borderColor: VERY_BAD_COLOR,
            data: count.map((it) => it["only-x11"]),
            fill: false,
          },
        ],
      },
      options: {
        ...options,
        title: {
          display: true,
          text:
            "flathub.org - apps with --wayland and --x11",
        },
      },
    });

    new Chart(document.getElementById("filesystem-chart").getContext("2d"), {
      type: "line",
      data: {
        labels: count.map((it) => it.key),
        datasets: [
          {
            label: "total",
            backgroundColor: TOTAL_COLOR,
            borderColor: TOTAL_COLOR,
            data: count.map((it) => it["no-filesystem"] + it.filesystem),
            fill: false,
            hidden: true,
          },
          {
            label: "--no-filesystem",
            backgroundColor: GOOD_COLOR,
            borderColor: GOOD_COLOR,
            data: count.map((it) => it["no-filesystem"]),
            fill: false,
          },
          {
            label: "--filesystem=<other>",
            backgroundColor: BAD_COLOR,
            borderColor: BAD_COLOR,
            data: count.map((it) => it["filesystem-other"]),
            fill: false,
          },
          {
            label: "--filesystem=home",
            backgroundColor: VERY_BAD_COLOR,
            borderColor: VERY_BAD_COLOR,
            data: count.map((it) => it["filesystem-home"]),
            fill: false,
          },
          {
            label: "--filesystem=host",
            backgroundColor: SUPER_BAD_COLOR,
            borderColor: SUPER_BAD_COLOR,
            data: count.map((it) => it["filesystem-host"]),
            fill: false,
          },
        ],
      },
      options: {
        ...options,
        title: {
          display: true,
          text: "flathub.org - apps with --filesystem",
        },
      },
    });

    new Chart(document.getElementById("device-chart").getContext("2d"), {
      type: "line",
      data: {
        labels: count.map((it) => it.key),
        datasets: [
        {
            label: "total",
            backgroundColor: TOTAL_COLOR,
            borderColor: TOTAL_COLOR,
            data: count.map((it) => it.device + it["no-device"]),
            fill: false,
            hidden: true,
          },
          {
            label: "--no-device",
            backgroundColor: GOOD_COLOR,
            borderColor: GOOD_COLOR,
            data: count.map((it) => it["no-device"]),
            fill: false,
          },
          {
            label: "--device=<other>",
            backgroundColor: BAD_COLOR,
            borderColor: BAD_COLOR,
            data: count.map((it) => it["device-other"]),
            fill: false,
          },
          {
            label: "--device=all",
            backgroundColor: VERY_BAD_COLOR,
            borderColor: VERY_BAD_COLOR,
            data: count.map((it) => it["device-all"]),
            fill: false,
          },
        ],
      },
      options: {
        ...options,
        title: {
          display: true,
          text: "flathub.org - apps with --device",
        },
      },
    });

    new Chart(document.getElementById("audio-server-chart").getContext("2d"), {
      type: "line",
      data: {
        labels: count.map((it) => it.key),
        datasets: [
        {
            label: "total",
            backgroundColor: TOTAL_COLOR,
            borderColor: TOTAL_COLOR,
            data: count.map((it) => it.pulseaudio + it["no-pulseaudio"]),
            fill: false,
            hidden: true,
          },
          {
            label: "--no-pulseaudio",
            backgroundColor: GOOD_COLOR,
            borderColor: GOOD_COLOR,
            data: count.map((it) => it["no-pulseaudio"]),
            fill: false,
          },
          {
            label: "--pulseaudio",
            backgroundColor: VERY_BAD_COLOR,
            borderColor: VERY_BAD_COLOR,
            data: count.map((it) => it.pulseaudio),
            fill: false,
          },
        ],
      },
      options: {
        ...options,
        title: {
          display: true,
          text: "flathub.org - apps with --pulseaudio",
        },
      },
    });


    new Chart(document.getElementById("metadata-filetype-chart").getContext("2d"), {
      type: "line",
      data: {
        labels: count.map((it) => it.key),
        datasets: [
          {
            label: ".json",
            backgroundColor: "#424242",
            borderColor: "#424242",
            data: count.map((it) => it.json),
            fill: false,
          },
          {
            label: ".yaml",
            backgroundColor: "#757575",
            borderColor: "#757575",
            data: count.map((it) => it.yaml),
            fill: false,
          },
          {
            label: ".yml",
            backgroundColor: "#bdbdbd",
            borderColor: "#bdbdbd",
            data: count.map((it) => it.yml),
            fill: false,
          },
        ],
      },
      options: {
        ...options,
        title: {
          display: true,
          text: "flathub.org - APP_ID.json vs APP_ID.yaml",
        },
      },
    });

  </script>
  
</html>
