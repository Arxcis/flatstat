<!DOCTYPE html5>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Flatstat | Graph</title>
    <link rel="stylesheet" type="text/css" href="./index.css"></link>
  </head>
  <body>
    <header>
      <a href="/"><h1 id="title" title="Flatstat | Graph">flatstat</h1></a>
      <nav>
        <a href="/" title="Graphs" class="active">graphs</a>
        <a href=/lists/ title="List">lists</a>
        <a href="/achievements/" title="Achievements">achievements</a>
        <a href="/about/" title="About">about</a>
      </nav>
    </header>
    <main>
      <nav>
        <a id="#total" title="Totals" href="/#total">total</a>
        <a id="#window" title="Apps with --wayland or --x11" href="/#window">window</a>
        <a id="#filesystem" title="Apps with --filesystem" href="/#filesystem">filesystem</a>
        <a id="#device" title="Apps with --device" href="/#device">device</a>
        <a id="#audio" title="Apps with --pulseaudio" href="/#audio">audio</a>
        <a id="#metafile" title=".json or .yaml or .yml" href="/#metafile">metafile</a>
      </nav>

      <section>
        <canvas id="total" width="400" height="250"></canvas>
        <canvas id="window" width="400" height="250"></canvas>
        <canvas id="filesystem" width="400" height="250"></canvas>
        <canvas id="device" width="400" height="250"></canvas>
        <canvas id="audio" width="400" height="250"></canvas>
        <canvas id="metafile" width="400" height="250"></canvas>
      </section>
    </main>
  </body>
  <script type="module">
    import "https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js";
    import count from "./db/flathub/count.js";
    import { countAchievements, countHoles, ACHIEVEMENTS, HOLES } from "./lib/achievements.js";
    import { useActiveLink } from "./lib/useActiveLink.js";
    
    useActiveLink("#total")

    // Define constants
    const TOTAL_COLOR = "#546e7a";
    const GOOD_COLOR = "#00c853";
    const BAD_COLOR = "#ff9100";
    const VERY_BAD_COLOR = "#ac0800";
    const SUPER_BAD_COLOR = "#4a148c";
    const APP_ICON = "ðŸ•¹ï¸"

    function achievementLabel(label) {
      return `${label} ðŸ… `
    }

    // Define options
    const options = {
      responsive: true,
      tooltips: {
        mode: "index",
        intersect: false,
      },
      hover: {
        mode: "nearest",
        intersect: true,
      },
      scales: {
        xAxes: [
          {
            display: true,
            scaleLabel: {
              display: true,
              labelString: "source: github.com/flathub/",
            },
          },
        ],
        yAxes: [
          {
            display: true,
            scaleLabel: {
              display: true,
              labelString: "#",
            },
          },
        ],
      },
    };

    // Draw charts
    new Chart(document.getElementById("total").getContext("2d"), {
      type: "line",
      data: {
        labels: count.map((it) => it.month),
        datasets: [
          {
            label: ` ðŸ… achievements earned`,
            backgroundColor: GOOD_COLOR,
            borderColor: GOOD_COLOR,
            data: count.map(it => countAchievements(it)),
            fill: false,
          },
          {
            label: ` ðŸ’¥ holes opened`,
            backgroundColor: VERY_BAD_COLOR,
            borderColor: VERY_BAD_COLOR,
            data: count.map(it => countHoles(it)),
            fill: false,
          },
          {
            label: `Â ${APP_ICON} apps published`,
            backgroundColor: SUPER_BAD_COLOR,
            borderColor: SUPER_BAD_COLOR,
            data: count.map(it => it["apps"]),
            fill: false,
          },
        ],
      },
      options: {
        ...options,
      },
    });

    new Chart(document.getElementById("window").getContext("2d"), {
      type: "line",
      data: {
        labels: count.map((it) => it.month),
        datasets: [
          {
            label: achievementLabel(ACHIEVEMENTS.WaylandWithFallback),
            backgroundColor: GOOD_COLOR,
            borderColor: GOOD_COLOR,
            data: count.map((it) => it[ACHIEVEMENTS.WaylandWithFallback]),
            fill: false,
          },
          {
            label: HOLES.X11,
            backgroundColor: VERY_BAD_COLOR,
            borderColor: VERY_BAD_COLOR,
            data: count.map((it) => it[HOLES.X11]),
            fill: false,
          },
        ],
      },
      options: {
        ...options,
      },
    });

    new Chart(document.getElementById("filesystem").getContext("2d"), {
      type: "line",
      data: {
        labels: count.map((it) => it.month),
        datasets: [
          {
            label: achievementLabel(ACHIEVEMENTS.NoFilesystem),
            backgroundColor: GOOD_COLOR,
            borderColor: GOOD_COLOR,
            data: count.map((it) => it[ACHIEVEMENTS.NoFilesystem]),
            fill: false,
          },
          {
            label: HOLES.FilesystemWellKnown,
            backgroundColor: BAD_COLOR,
            borderColor: BAD_COLOR,
            data: count.map((it) => it[HOLES.FilesystemWellKnown]),
            fill: false,
          },
          {
            label: HOLES.FilesystemUnknown,
            backgroundColor: VERY_BAD_COLOR,
            borderColor: VERY_BAD_COLOR,
            data: count.map((it) => it[HOLES.FilesystemUnknown]),
            fill: false,
          },
          {
            label: HOLES.FilesystemAll,
            backgroundColor: SUPER_BAD_COLOR,
            borderColor: SUPER_BAD_COLOR,
            data: count.map((it) => it[HOLES.FilesystemAll]),
            fill: false,
          },
        ],
      },
      options: {
        ...options,
      },
    });

    new Chart(document.getElementById("device").getContext("2d"), {
      type: "line",
      data: {
        labels: count.map((it) => it.month),
        datasets: [
          {
            label: achievementLabel(ACHIEVEMENTS.NoDevice),
            backgroundColor: GOOD_COLOR,
            borderColor: GOOD_COLOR,
            data: count.map((it) => it[ACHIEVEMENTS.NoDevice]),
            fill: false,
          },
          {
            label: HOLES.DeviceWellKnown,
            backgroundColor: BAD_COLOR,
            borderColor: BAD_COLOR,
            data: count.map((it) => it[HOLES.DeviceWellKnown]),
            fill: false,
          },
          {
            label: HOLES.DeviceAll,
            backgroundColor: VERY_BAD_COLOR,
            borderColor: VERY_BAD_COLOR,
            data: count.map((it) => it[HOLES.DeviceAll]),
            fill: false,
          },
        ],
      },
      options: {
        ...options,
      },
    });

    new Chart(document.getElementById("audio").getContext("2d"), {
      type: "line",
      data: {
        labels: count.map((it) => it.month),
        datasets: [
          {
            label: achievementLabel(ACHIEVEMENTS.NoPulseaudio),
            backgroundColor: GOOD_COLOR,
            borderColor: GOOD_COLOR,
            data: count.map((it) => it[ACHIEVEMENTS.NoPulseaudio]),
            fill: false,
          },
          {
            label: HOLES.Pulseaudio,
            backgroundColor: VERY_BAD_COLOR,
            borderColor: VERY_BAD_COLOR,
            data: count.map((it) => it[HOLES.Pulseaudio]),
            fill: false,
          },
        ],
      },
      options: {
        ...options,
      },
    });


    new Chart(document.getElementById("metafile").getContext("2d"), {
      type: "line",
      data: {
        labels: count.map((it) => it.month),
        datasets: [
          {
            label: ".json",
            backgroundColor: "#424242",
            borderColor: "#424242",
            data: count.map((it) => it.json),
            fill: false,
          },
          {
            label: ".yaml",
            backgroundColor: "#757575",
            borderColor: "#757575",
            data: count.map((it) => it.yaml),
            fill: false,
          },
          {
            label: ".yml",
            backgroundColor: "#bdbdbd",
            borderColor: "#bdbdbd",
            data: count.map((it) => it.yml),
            fill: false,
          },
        ],
      },
      options: {
        ...options,
      },
    });

  </script>
  
</html>
