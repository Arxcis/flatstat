<!DOCTYPE html5>
<html>
  <head>
    <meta charset="utf-8" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
    <title>Flatpak DB</title>
  </head>
  <body>
    <main style="width: 600px; margin: auto">
      <h1>Flatpak DB</h1>
      <canvas id="x11-wayland-chart" width="400" height="300"></canvas>
      <canvas id="filesystem-chart" width="400" height="300"></canvas>

      <h3>About the data</h3>
      <p>
        The data is gathered from public repos found under
        <a href="https://github.com/flathub/">https://github.com/flathub/</a>
      </p>
      <p>
        In each repo, we look for the respective APP_ID.json or APP_ID.yaml
        file.
      </p>
      <p>
        To get the data, Github's Graphql API v4 was used
        <a href="https://api.github.com/graphql"
          >https://api.github.com/graphql</a
        >.
      </p>
      <p>
        Source code:
        <a href="https://github.com/Arxcis/flatpak-db"
          >https://github.com/Arxcis/flatpak-db</a
        >/
      </p>
    </main>
  </body>
  <script type="module">
    import count from "./src/db/flathub/count.js";

    const options = {
      responsive: true,
      title: {
        display: true,
        text: "Flathub.org apps Jan 2018 - Nov 2020",
      },
      tooltips: {
        mode: "index",
        intersect: false,
      },
      hover: {
        mode: "nearest",
        intersect: true,
      },
      scales: {
        xAxes: [
          {
            display: true,
            scaleLabel: {
              display: true,
              labelString: "Month",
            },
          },
        ],
        yAxes: [
          {
            display: true,
            scaleLabel: {
              display: true,
              labelString: "Value",
            },
          },
        ],
      },
    };

    new Chart(document.getElementById("x11-wayland-chart").getContext("2d"), {
      type: "line",
      data: {
        labels: count.map((it) => it.key),
        datasets: [
          {
            label: "all",
            backgroundColor: "grey",
            borderColor: "grey",
            data: count.map((it) => it.gui),
            fill: false,
          },
          {
            label: "x11",
            backgroundColor: "red",
            borderColor: "red",
            data: count.map((it) => it.x11),
            fill: false,
          },
          {
            label: "wayland",
            backgroundColor: "green",
            borderColor: "green",
            data: count.map((it) => it.wayland),
            fill: false,
          },
          {
            label: "only x11",
            backgroundColor: "indigo",
            borderColor: "indigo",
            data: count.map((it) => it["only-x11"]),
            fill: false,
          },
          {
            label: "only wayland",
            backgroundColor: "orange",
            borderColor: "orange",
            data: count.map((it) => it["only-wayland"]),
            fill: false,
          },
        ],
      },
      options: {
        ...options,
        title: {
          display: true,
          text:
            "flathub.org / Apps by display technology (--socket=x11, --socket=wayland)",
        },
      },
    });

    new Chart(document.getElementById("filesystem-chart").getContext("2d"), {
      type: "line",
      data: {
        labels: count.map((it) => it.key),
        datasets: [
          {
            label: "all",
            backgroundColor: "grey",
            borderColor: "grey",
            data: count.map((it) => it["no-filesystem"] + it.filesystem),
            fill: false,
          },
          {
            label: "--no-filesystem",
            backgroundColor: "green",
            borderColor: "green",
            data: count.map((it) => it["no-filesystem"]),
            fill: false,
          },
          {
            label: "--filesystem=<some>",
            backgroundColor: "blue",
            borderColor: "blue",
            data: count.map((it) => it.filesystem),
            fill: false,
          },
          {
            label: "--filesystem=home",
            backgroundColor: "hotpink",
            borderColor: "hotpink",
            data: count.map((it) => it.filesystemHome),
            fill: false,
          },
          {
            label: "--filesystem=host",
            backgroundColor: "red",
            borderColor: "red",
            data: count.map((it) => it.filesystemHost),
            fill: false,
          },
        ],
      },
      options: {
        ...options,
        title: {
          display: true,
          text: "flathub.org / Apps by filesystem permissions (--filesystem)",
        },
      },
    });
  </script>
</html>
